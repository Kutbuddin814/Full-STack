<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Dual Access Portal</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #4e54c8, #8f94fb);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
    }

    .container {
      background: #fff;
      padding: 40px 35px;
      border-radius: 18px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
      width: 380px;
      text-align: center;
      animation: fadeIn 0.8s ease;
    }

    h2 {
      color: #4e54c8;
      margin-bottom: 25px;
      font-size: 26px;
      font-weight: 700;
      user-select: text;
    }

    .input-group {
      position: relative;
      margin-bottom: 18px;
      text-align: left;
      user-select: text;
    }

    .input-group input,
    .input-group select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid #ccc;
      font-size: 16px;
      background: #f9f9ff;
      transition: all 0.3s ease;
      font-family: inherit;
      box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.05);
      user-select: text;
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: #4e54c8;
      box-shadow: 0 0 8px rgba(78, 84, 200, 0.4);
      background: #fff;
      user-select: text;
    }

    .password-container {
      position: relative;
    }

    .toggle-password {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 18px;
      cursor: pointer;
      color: #4e54c8;
      user-select: none;
    }

    button {
      background: linear-gradient(135deg, #4e54c8, #8f94fb);
      color: #fff;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      width: 100%;
      cursor: pointer;
      margin-top: 12px;
      font-weight: 700;
      transition: all 0.3s ease;
      user-select: none;
    }

    button:hover,
    button:focus-visible {
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(78, 84, 200, 0.4);
    }

    .toggle-link {
      display: block;
      margin-top: 18px;
      font-size: 14px;
      color: #4e54c8;
      cursor: pointer;
      transition: color 0.2s ease;
      user-select: text;
    }

    .toggle-link:hover {
      color: #3f43a9;
    }

    #responseText {
      margin-top: 18px;
      font-size: 14px;
      font-weight: 700;
      user-select: text;
    }

    .hidden {
      display: none;
    }

    .success {
      color: green;
    }

    .error {
      color: red;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(15px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Toast notification */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #4e54c8;
      color: #fff;
      padding: 14px 22px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.4s ease;
      z-index: 1000;
      user-select: none;
      font-weight: 700;
      font-size: 16px;
      max-width: 360px;
      text-align: center;
      word-break: break-word;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }
  </style>
</head>

<body>

  <div class="container" role="main" aria-labelledby="formTitle">
    <h2 id="formTitle">Login</h2>

    <!-- LOGIN FORM -->
    <form id="loginForm" novalidate>
      <div class="input-group">
        <label for="loginUsername" class="sr-only">Username</label>
        <input type="text" id="loginUsername" placeholder="Username" required aria-required="true" autocomplete="username" />
      </div>
      <div class="input-group password-container">
        <label for="loginPassword" class="sr-only">Password</label>
        <input type="password" id="loginPassword" placeholder="Password" required aria-required="true" autocomplete="current-password" />
        <span class="toggle-password" role="button" aria-label="Toggle login password visibility" tabindex="0" onclick="togglePassword('loginPassword')" onkeypress="if(event.key==='Enter' || event.key===' ') togglePassword('loginPassword')">üëÅ</span>
      </div>
      <button type="submit">Login</button>
      <span class="toggle-link" role="button" tabindex="0" onclick="toggleForm('signup')" onkeypress="if(event.key==='Enter' || event.key===' ') toggleForm('signup')">Don‚Äôt have an account? Sign up</span>
    </form>

    <!-- SIGNUP FORM -->
    <form id="signupForm" class="hidden" novalidate>
      <div class="input-group">
        <label for="newUsername" class="sr-only">Username</label>
        <input type="text" id="newUsername" placeholder="Username" required aria-required="true" autocomplete="username" />
      </div>
      <div class="input-group">
        <label for="newEmail" class="sr-only">Email</label>
        <input type="email" id="newEmail" placeholder="Email" required aria-required="true" autocomplete="email" />
      </div>
      <div class="input-group password-container">
        <label for="newPassword" class="sr-only">Password</label>
        <input type="password" id="newPassword" placeholder="Password" required aria-required="true" autocomplete="new-password" />
        <span class="toggle-password" role="button" aria-label="Toggle signup password visibility" tabindex="0" onclick="togglePassword('newPassword')" onkeypress="if(event.key==='Enter' || event.key===' ') togglePassword('newPassword')">üëÅ</span>
      </div>
      <div class="input-group password-container">
        <label for="confirmPassword" class="sr-only">Confirm Password</label>
        <input type="password" id="confirmPassword" placeholder="Confirm Password" required aria-required="true" autocomplete="new-password" />
        <span class="toggle-password" role="button" aria-label="Toggle confirm password visibility" tabindex="0" onclick="togglePassword('confirmPassword')" onkeypress="if(event.key==='Enter' || event.key===' ') togglePassword('confirmPassword')">üëÅ</span>
      </div>
      <div class="input-group">
        <label for="newRole" class="sr-only">Role</label>
        <select id="newRole" required aria-required="true">
          <option value="user">User</option>
          <option value="client">Client</option>
          <option value="freelancer">Freelancer</option>
          <option value="admin">Admin</option>
        </select>
      </div>
      <button type="submit">Sign Up</button>
      <span class="toggle-link" role="button" tabindex="0" onclick="toggleForm('login')" onkeypress="if(event.key==='Enter' || event.key===' ') toggleForm('login')">Already have an account? Login</span>
    </form>

    <p id="responseText" role="alert" aria-live="assertive" aria-atomic="true"></p>
  </div>

  <!-- Toast Popup -->
  <div id="toast" class="toast" aria-live="assertive" aria-atomic="true"></div>

  <script>
    const API_BASE = "http://localhost:3000/api"; // backend server

    function toggleForm(type) {
      const loginForm = document.getElementById("loginForm");
      const signupForm = document.getElementById("signupForm");
      const formTitle = document.getElementById("formTitle");
      const responseText = document.getElementById("responseText");

      if (type === "signup") {
        loginForm.classList.add("hidden");
        signupForm.classList.remove("hidden");
        formTitle.innerText = "Sign Up";
      } else {
        signupForm.classList.add("hidden");
        loginForm.classList.remove("hidden");
        formTitle.innerText = "Login";
      }
      responseText.innerText = "";
    }

    function togglePassword(id) {
      const field = document.getElementById(id);
      field.type = field.type === "password" ? "text" : "password";
    }

    // Toast popup function
    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 3000);
    }

// SIGNUP HANDLER with password validation
document.getElementById("signupForm").addEventListener("submit", async function (e) {
  e.preventDefault();
  const username = document.getElementById("newUsername").value.trim();
  const email = document.getElementById("newEmail").value.trim();
  const password = document.getElementById("newPassword").value.trim();
  const confirmPassword = document.getElementById("confirmPassword").value.trim();
  const role = document.getElementById("newRole").value;

  // Password length validation: minimum 6 characters
  if (password.length < 6) {
    const responseText = document.getElementById("responseText");
    responseText.innerText = "Password must be at least 6 characters long!";
    responseText.className = "error";
    return;
  }

  // Password special character validation using regex
  // /[!@#$%^&*(),.?":{}|<>]/ matches common special characters
  if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
    const responseText = document.getElementById("responseText");
    responseText.innerText = "Password must contain at least one special character!";
    responseText.className = "error";
    return;
  }

  // Confirm password matches
  if (password !== confirmPassword) {
    const responseText = document.getElementById("responseText");
    responseText.innerText = "Passwords do not match!";
    responseText.className = "error";
    return;
  }

  try {
    const response = await fetch(`${API_BASE}/signup`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, email, password, role }),
      mode: "cors"
    });

    const data = await response.json();
    if (response.ok) {
      const responseText = document.getElementById("responseText");
      responseText.innerText = "Signup successful! Please login now.";
      responseText.className = "success";
      setTimeout(() => toggleForm("login"), 1500);
    } else {
      throw new Error(data.message || "Signup failed");
    }
  } catch (err) {
    const responseText = document.getElementById("responseText");
    responseText.innerText = "Signup Error: " + err.message;
    responseText.className = "error";
  }
});

    // Show flash message on index.html load
    if (window.location.pathname.includes("index.html")) {
      const flash = localStorage.getItem("flashMessage");
      if (flash) {
        const msg = JSON.parse(flash);
        if (msg.type === "success") showToast(msg.text);
        localStorage.removeItem("flashMessage");
      }
    }
  </script>

  <style>
    /* Accessibility helper */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }
  </style>
</body>

</html>
